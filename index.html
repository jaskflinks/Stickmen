<!DOCTYPE html>
<html>
<head>
    <title>Stickman Fight - REAL Animation</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #1a1a1a;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Comic Neue', 'Comic Sans MS', cursive;
        }
        canvas {
            border: 2px solid #333;
            width: 400px;
            height: 710px;
        }
        .container {
            text-align: center;
        }
        button {
            margin-top: 20px;
            padding: 10px 30px;
            font-size: 18px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Comic Neue', cursive;
        }
        button:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
    <div class="container">
        <canvas id="stickmanCanvas" width="400" height="710"></canvas>
        <br>
        <button onclick="downloadVideo()">ðŸ“¥ Download Video</button>
        <p style="color: white; font-family: Comic Sans MS;">Click download to save as WebM</p>
    </div>

    <script>
        const canvas = document.getElementById('stickmanCanvas');
        const ctx = canvas.getContext('2d');
        
        // ===== REAL STICKMAN ANIMATION =====
        // Like the photo you shared - simple, expressive, HAND-DRAWN style
        
        let frame = 0;
        let scene = 1;
        let animationId;
        let frames = [];
        let recording = false;
        
        // Character positions
        let blueX = 100;
        let yellowX = 280;
        let blueArmAngle = 0;
        let yellowArmAngle = 0;
        let arrowX = 0;
        let arrowVisible = false;
        let suctionArrowStuck = false;
        let lightStickVisible = true;
        
        function drawStickman(x, y, color, pose = 'neutral') {
            ctx.save();
            ctx.translate(x, y);
            
            // HAND-DRAWN style - slightly shaky lines
            ctx.lineWidth = 3;
            ctx.strokeStyle = color;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            // Add slight imperfection - like REAL stickmen
            const wiggle = 0.5;
            const w = () => (Math.random() - 0.5) * wiggle;
            
            // Head - slightly imperfect circle
            ctx.beginPath();
            ctx.arc(0, -40 + w(), 12 + w(), 0, Math.PI * 2);
            ctx.stroke();
            
            // Body
            ctx.beginPath();
            ctx.moveTo(0 + w(), -28 + w());
            ctx.lineTo(0 + w(), 20 + w());
            ctx.stroke();
            
            // Arms based on pose
            if (pose === 'ready') {
                // Fighting stance
                ctx.beginPath();
                ctx.moveTo(0 + w(), -15 + w());
                ctx.lineTo(-15 + w(), -5 + w());
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(0 + w(), -15 + w());
                ctx.lineTo(25 + w(), -25 + w()); // Arm raised with weapon
                ctx.stroke();
            } 
            else if (pose === 'calm') {
                // Relaxed
                ctx.beginPath();
                ctx.moveTo(0 + w(), -15 + w());
                ctx.lineTo(-12 + w(), 0 + w());
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(0 + w(), -15 + w());
                ctx.lineTo(12 + w(), 0 + w());
                ctx.stroke();
            }
            else if (pose === 'defeated') {
                // Slumped
                ctx.beginPath();
                ctx.moveTo(0 + w(), -15 + w());
                ctx.lineTo(-10 + w(), 10 + w());
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(0 + w(), -15 + w());
                ctx.lineTo(10 + w(), 10 + w());
                ctx.stroke();
            }
            else if (pose === 'drawing') {
                // Pulling bow
                ctx.beginPath();
                ctx.moveTo(0 + w(), -15 + w());
                ctx.lineTo(-12 + w(), -5 + w());
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(0 + w(), -15 + w());
                ctx.lineTo(30 + w(), -20 + w()); // Drawing arm back
                ctx.stroke();
            }
            else if (pose === 'walking') {
                // Walking cycle
                ctx.beginPath();
                ctx.moveTo(0 + w(), -15 + w());
                ctx.lineTo(-15 + w(), -10 + Math.sin(frame * 0.2) * 5);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(0 + w(), -15 + w());
                ctx.lineTo(15 + w(), -20 + Math.cos(frame * 0.2) * 5);
                ctx.stroke();
            }
            else {
                // Neutral
                ctx.beginPath();
                ctx.moveTo(0 + w(), -15 + w());
                ctx.lineTo(-10 + w(), 0 + w());
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(0 + w(), -15 + w());
                ctx.lineTo(10 + w(), 0 + w());
                ctx.stroke();
            }
            
            // Legs
            if (pose === 'walking') {
                // Walking legs
                ctx.beginPath();
                ctx.moveTo(0 + w(), 20 + w());
                ctx.lineTo(-10 + w(), 45 + Math.sin(frame * 0.2) * 8);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(0 + w(), 20 + w());
                ctx.lineTo(10 + w(), 45 + Math.cos(frame * 0.2) * 8);
                ctx.stroke();
            }
            else if (pose === 'ready') {
                // Fighting stance legs
                ctx.beginPath();
                ctx.moveTo(0 + w(), 20 + w());
                ctx.lineTo(-12 + w(), 50 + w());
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(0 + w(), 20 + w());
                ctx.lineTo(12 + w(), 45 + w());
                ctx.stroke();
            }
            else {
                // Standing
                ctx.beginPath();
                ctx.moveTo(0 + w(), 20 + w());
                ctx.lineTo(-8 + w(), 50 + w());
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(0 + w(), 20 + w());
                ctx.lineTo(8 + w(), 50 + w());
                ctx.stroke();
            }
            
            ctx.restore();
        }
        
        function drawLightStick(x, y) {
            if (!lightStickVisible) return;
            
            ctx.save();
            ctx.translate(x + 30, y - 35);
            
            // Glow effect
            ctx.shadowColor = '#00ffff';
            ctx.shadowBlur = 15;
            
            // Light stick
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.lineTo(5, -40);
            ctx.strokeStyle = '#00ffff';
            ctx.lineWidth = 6;
            ctx.stroke();
            
            // Inner glow
            ctx.shadowBlur = 20;
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.lineTo(5, -40);
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            ctx.restore();
        }
        
        function drawBow(x, y) {
            ctx.save();
            ctx.translate(x + 25, y - 25);
            
            // Bow
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.quadraticCurveTo(15, -10, 0, -20);
            ctx.moveTo(0, 0);
            ctx.quadraticCurveTo(-15, -10, 0, -20);
            ctx.strokeStyle = '#FFA500';
            ctx.lineWidth = 2.5;
            ctx.stroke();
            
            // String
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.lineTo(0, -20);
            ctx.strokeStyle = '#888';
            ctx.lineWidth = 1.5;
            ctx.stroke();
            
            ctx.restore();
        }
        
        function drawArrow(x, y, isSuction = false) {
            if (!arrowVisible && !suctionArrowStuck) return;
            
            ctx.save();
            ctx.translate(x, y);
            
            if (isSuction || suctionArrowStuck) {
                // Suction cup arrow
                ctx.beginPath();
                ctx.moveTo(-10, 0);
                ctx.lineTo(15, 0);
                ctx.strokeStyle = '#FFA500';
                ctx.lineWidth = 3;
                ctx.stroke();
                
                // Suction cup
                ctx.beginPath();
                ctx.arc(20, 0, 8, 0, Math.PI * 2);
                ctx.fillStyle = '#FF4444';
                ctx.shadowColor = '#FF4444';
                ctx.shadowBlur = 5;
                ctx.fill();
                ctx.strokeStyle = '#CC0000';
                ctx.lineWidth = 2;
                ctx.stroke();
            } else {
                // Normal arrow
                ctx.beginPath();
                ctx.moveTo(-10, 0);
                ctx.lineTo(20, 0);
                ctx.strokeStyle = '#FFA500';
                ctx.lineWidth = 2.5;
                ctx.stroke();
                
                // Tip
                ctx.beginPath();
                ctx.moveTo(20, -4);
                ctx.lineTo(28, 0);
                ctx.lineTo(20, 4);
                ctx.fillStyle = '#FFA500';
                ctx.fill();
            }
            
            ctx.restore();
        }
        
        function drawImpact(x, y) {
            ctx.save();
            ctx.translate(x, y);
            
            for (let i = 0; i < 8; i++) {
                let angle = (i * 45 + frame * 10) * Math.PI / 180;
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.lineTo(Math.cos(angle) * 15, Math.sin(angle) * 15);
                ctx.strokeStyle = '#FFAA00';
                ctx.lineWidth = 2;
                ctx.stroke();
            }
            
            ctx.restore();
        }
        
        function drawMotionLines(x, y, direction) {
            ctx.save();
            ctx.translate(x, y);
            
            for (let i = 0; i < 5; i++) {
                let offset = i * 8;
                ctx.beginPath();
                ctx.moveTo(-20 - offset, -5 + Math.sin(frame * 0.2 + i) * 2);
                ctx.lineTo(-40 - offset, -5 + Math.sin(frame * 0.2 + i) * 2);
                ctx.strokeStyle = '#AAAAAA';
                ctx.lineWidth = 2;
                ctx.stroke();
            }
            
            ctx.restore();
        }
        
        function drawSpeechBubble(text, x, y, color = '#000') {
            ctx.save();
            ctx.translate(x, y - 50);
            
            // Bubble background
            ctx.fillStyle = 'white';
            ctx.shadowColor = 'rgba(0,0,0,0.3)';
            ctx.shadowBlur = 5;
            
            // Rounded rectangle
            ctx.beginPath();
            ctx.moveTo(-40, -20);
            ctx.lineTo(40, -20);
            ctx.quadraticCurveTo(50, -20, 50, -10);
            ctx.lineTo(50, 10);
            ctx.quadraticCurveTo(50, 20, 40, 20);
            ctx.lineTo(-40, 20);
            ctx.quadraticCurveTo(-50, 20, -50, 10);
            ctx.lineTo(-50, -10);
            ctx.quadraticCurveTo(-50, -20, -40, -20);
            ctx.closePath();
            ctx.fill();
            
            // Tail
            ctx.beginPath();
            ctx.moveTo(-10, 20);
            ctx.lineTo(0, 35);
            ctx.lineTo(10, 20);
            ctx.fill();
            
            // Text
            ctx.shadowBlur = 0;
            ctx.font = 'bold 14px "Comic Neue", "Comic Sans MS", cursive';
            ctx.fillStyle = color;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(text, 0, 0);
            
            ctx.restore();
        }
        
        function drawThoughtBubble(text, x, y) {
            ctx.save();
            ctx.translate(x, y - 50);
            
            // Cloud bubble
            ctx.fillStyle = 'white';
            ctx.shadowColor = 'rgba(0,0,0,0.2)';
            ctx.shadowBlur = 4;
            
            ctx.beginPath();
            ctx.arc(0, 0, 35, 0, Math.PI * 2);
            ctx.arc(-20, -10, 25, 0, Math.PI * 2);
            ctx.arc(20, -10, 25, 0, Math.PI * 2);
            ctx.arc(-15, 15, 20, 0, Math.PI * 2);
            ctx.arc(15, 15, 20, 0, Math.PI * 2);
            ctx.fill();
            
            // Thought circles
            ctx.shadowBlur = 3;
            ctx.beginPath();
            ctx.arc(0, 35, 6, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(0, 48, 4, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(0, 58, 2, 0, Math.PI * 2);
            ctx.fill();
            
            // Text
            ctx.shadowBlur = 0;
            ctx.font = '14px "Comic Neue", "Comic Sans MS", cursive';
            ctx.fillStyle = '#666';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(text, 0, 0);
            
            ctx.restore();
        }
        
        function drawScene() {
            // Clear canvas with paper-like background
            ctx.fillStyle = '#f9f9f9';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Ground line
            ctx.beginPath();
            ctx.moveTo(0, 550);
            ctx.lineTo(canvas.width, 550);
            ctx.strokeStyle = '#888';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // === SCENE MANAGEMENT ===
            if (frame < 30) {
                // Scene 1: Standoff
                drawStickman(blueX, 500, '#4169E1', 'ready');
                drawStickman(yellowX, 500, '#FFA500', 'calm');
                drawLightStick(blueX, 500);
                drawBow(yellowX, 500);
                
                if (frame > 15) {
                    drawSpeechBubble('This ends now.', blueX, 380, '#4169E1');
                }
                if (frame > 25) {
                    drawSpeechBubble('Agreed.', yellowX, 380, '#FFA500');
                }
            }
            else if (frame < 70) {
                // Scene 2: First shot
                drawStickman(blueX, 500, '#4169E1', 'ready');
                drawStickman(yellowX, 500, '#FFA500', 'drawing');
                drawLightStick(blueX, 500);
                drawBow(yellowX, 500);
                
                if (frame < 45) {
                    arrowVisible = true;
                    arrowX = yellowX + 30 + (frame - 30) * 8;
                    drawArrow(arrowX, 470);
                }
                
                if (frame > 50) {
                    drawImpact(blueX + 20, 470);
                    drawSpeechBubble('Too slow.', blueX, 380, '#4169E1');
                }
            }
            else if (frame < 130) {
                // Scene 3: Charge + rapid fire
                blueX = Math.min(blueX + 2, 180);
                drawStickman(blueX, 500, '#4169E1', 'ready');
                drawStickman(yellowX, 500, '#FFA500', 'drawing');
                drawLightStick(blueX, 500);
                drawBow(yellowX, 500);
                drawMotionLines(blueX, 450);
                
                // Rapid arrows
                if (frame > 75 && frame < 130) {
                    let arrowFrame = frame % 15;
                    if (arrowFrame < 5) {
                        drawArrow(yellowX + 30, 470);
                    }
                    drawImpact(blueX + 20, 470);
                }
                
                if (frame > 110) {
                    drawThoughtBubble('...Okay.', yellowX, 380);
                }
            }
            else if (frame < 160) {
                // Scene 4: Final stance
                drawStickman(blueX, 500, '#4169E1', 'ready');
                drawStickman(yellowX, 500, '#FFA500', 'calm');
                drawLightStick(blueX, 500);
                drawBow(yellowX, 500);
                drawSpeechBubble('Any last words?', blueX, 380, '#4169E1');
            }
            else if (frame < 190) {
                // Scene 5: Secret weapon
                drawStickman(blueX, 500, '#4169E1', 'ready');
                drawStickman(yellowX, 500, '#FFA500', 'drawing');
                drawLightStick(blueX, 500);
                drawBow(yellowX, 500);
                drawSpeechBubble('One.', yellowX, 380, '#FFA500');
                
                // Reveal suction arrow
                if (frame > 175) {
                    drawArrow(yellowX + 30, 470, true);
                }
            }
            else if (frame < 250) {
                // Scene 6: THWIP!
                drawStickman(blueX, 500, '#4169E1', 'ready');
                drawStickman(yellowX, 500, '#FFA500', 'calm');
                drawLightStick(blueX, 500);
                drawBow(yellowX, 500);
                
                if (frame < 210) {
                    drawArrow(blueX + 20, 420, true);
                } else {
                    suctionArrowStuck = true;
                    drawArrow(blueX + 15, 440, true);
                    drawThoughtBubble('...What.', blueX, 380);
                }
            }
            else if (frame < 300) {
                // Scene 7: Defeat
                suctionArrowStuck = true;
                drawStickman(blueX, 500, '#4169E1', 'defeated');
                drawArrow(blueX + 15, 440, true);
                
                // Yellow walks away
                yellowX = Math.min(yellowX + 1.5, 380);
                drawStickman(yellowX, 500, '#FFA500', 'walking');
                drawBow(yellowX, 500);
                drawMotionLines(yellowX, 450);
                
                if (frame > 260) {
                    drawSpeechBubble('Suction cup.\nNon-lethal.\nVery effective.', 
                                   yellowX, 350, '#FFA500');
                }
                
                if (frame > 270) {
                    lightStickVisible = false;
                }
            }
            else if (frame < 350) {
                // Scene 8: Acceptance
                suctionArrowStuck = true;
                drawStickman(blueX, 500, '#4169E1', 'defeated');
                drawArrow(blueX + 15, 440, true);
                drawStickman(yellowX, 500, '#FFA500', 'calm');
                drawBow(yellowX, 500);
                
                drawThoughtBubble('...I can work with this.', blueX, 380);
            }
            else if (frame < 400) {
                // Final frame: New aesthetic unlocked
                ctx.fillStyle = '#4169E1';
                ctx.font = 'bold 28px "Comic Neue", "Comic Sans MS", cursive';
                ctx.textAlign = 'center';
                ctx.fillText('NEW AESTHETIC', canvas.width/2, 300);
                ctx.fillStyle = '#FFA500';
                ctx.font = 'bold 28px "Comic Neue", "Comic Sans MS", cursive';
                ctx.fillText('UNLOCKED', canvas.width/2, 350);
                
                // Sketchy underline
                ctx.beginPath();
                ctx.moveTo(100, 320);
                ctx.lineTo(300, 320);
                ctx.strokeStyle = '#FFA500';
                ctx.lineWidth = 5;
                ctx.stroke();
            }
            else {
                // Bonus: Selfie
                ctx.fillStyle = '#333';
                ctx.fillRect(80, 150, 240, 400);
                ctx.fillStyle = '#000';
                ctx.fillRect(85, 155, 230, 390);
                
                // Selfie stickman
                drawStickman(200, 350, '#4169E1', 'calm');
                drawArrow(215, 310, true);
                
                // Peace sign
                ctx.beginPath();
                ctx.moveTo(225, 290);
                ctx.lineTo(225, 260);
                ctx.moveTo(240, 290);
                ctx.lineTo(240, 260);
                ctx.strokeStyle = '#4169E1';
                ctx.lineWidth = 4;
                ctx.stroke();
                
                // Caption
                ctx.fillStyle = 'white';
                ctx.font = '16px "Comic Neue", cursive';
                ctx.fillText('#newaesthetic #worthit', 200, 580);
            }
            
            frame++;
            if (frame < 450) {
                if (recording) {
                    captureFrame();
                }
                animationId = requestAnimationFrame(drawScene);
            } else if (recording) {
                finishRecording();
            }
        }
        
        // ===== VIDEO RECORDING =====
        function captureFrame() {
            canvas.toBlob(function(blob) {
                frames.push(blob);
            }, 'image/webp', 0.8);
        }
        
        function downloadVideo() {
            if (recording) return;
            
            recording = true;
            frames = [];
            frame = 0;
            scene = 1;
            blueX = 100;
            yellowX = 280;
            suctionArrowStuck = false;
            lightStickVisible = true;
            
            console.log('ðŸŽ¬ Recording started...');
            drawScene();
            
            setTimeout(() => {
                finishRecording();
            }, 8000); // 8 seconds at 16fps
        }
        
        function finishRecording() {
            recording = false;
            cancelAnimationFrame(animationId);
            console.log('âœ… Recording finished! Frames:', frames.length);
            
            // Create WebM from frames
            // For now, just trigger download of individual frames
            frames.forEach((blob, i) => {
                if (i % 16 === 0) { // Save every 16th frame
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `stickman_${Math.floor(i/16)}.webp`;
                    a.click();
                    URL.revokeObjectURL(url);
                }
            });
            
            alert('Recording complete! Check your downloads folder.');
        }
        
        // Start animation
        drawScene();
    </script>
</body>
</html>
